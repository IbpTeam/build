#!/bin/bash
if [ "$CROOT" == "" ] ; then
  echo ERROR: You should execute . set_env at project root path.
  exit 1
fi
echo
echo -----------------------------------
echo Build node modules
echo
set -e
# This script mustn't be run with root rights.
if [ $UID -eq 0 ]; then
    echo Error! You should not run this shell with root rights.
    exit 1
fi

if [ $# -ge 1 ] ; then
    if [ ! "$1" == "--node" ] ; then
         echo Error: can not recognize these param: $*
         exit 1
    fi
fi

pushd $PWD
cd $CROOT/src/node_modules

for file in `ls`
do
    if [ -d $file ] ; then
        pushd $PWD
        cd $file
        bash $CROOT/build/core/build_single_module.sh $*
        popd
    fi
done

cd $CROOT/app/demo-rio/nodewebkit
bash $CROOT/build/core/link_modules_for_app.sh $CROOT/app/demo-rio/nodewebkit
npm link

popd

echo
echo Successed building node modules.
echo ===================================
echo
