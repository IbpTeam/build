#!/bin/bash
echo
echo -----------------------------------
echo Build node modules
echo
set -e
CURRENTPATH=$(cd `dirname $0`; pwd)
. $(cd `dirname $CURRENTPATH`; pwd)/envsetup.sh nosetenv
setenv

cd $(gettop)/src/node_modules

for file in `ls`
do
    if [ -d $file ] ; then
        echo 
        echo ------------------
        echo Build $file
        echo 
        pushd $PWD
        cd $file
        npm link
        if [ -f binding.gyp ] ; then
            nw-gyp rebuild --target=0.8.4
        fi
        if [ "$file" == "sqlite3" ] ; then
            nw-gyp rebuild --target=0.8.4
        fi
        popd
        echo 
        echo Successed building $file.
        echo ==================
        echo 
    fi
done
echo
echo Successed building node.js.
echo ===================================
echo
